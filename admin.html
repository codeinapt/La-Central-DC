<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Admin</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1> Panel de Administraci贸n</h1>

  <div id="login">
    <h2>Acceso restringido</h2>
    <input type="password" id="clave" placeholder="Ingrese contrase帽a" />
    <button onclick="verificarClave()">Entrar</button>
  </div>

  <div id="contenido" style="display:none;">
    <!-- Secci贸n usuarios -->
    <h2> Agregar usuario</h2>
    <input id="nombre" placeholder="Nombre" />
    <button id="btnAgregarUsuario">Agregar Usuario</button>

    <!-- Secci贸n deudas -->
    <h2> Crear nueva deuda</h2>
    <input id="montoDeuda" type="number" placeholder="Monto de deuda" />
    <button id="btnAgregarDeuda">Asignar deuda a todos</button>

    <h2> Usuarios y deudas</h2>
    <table id="tabla">
      <tr><th>Nombre</th><th>Deudas</th></tr>
    </table>
  </div>

  <!-- Firebase SDK compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Configuraci贸n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAX52Luy0Ehmy2Gzcj9E_oV4NgLTngIrsw",
      authDomain: "finanzas-9cf9a.firebaseapp.com",
      databaseURL: "https://finanzas-9cf9a-default-rtdb.firebaseio.com",
      projectId: "finanzas-9cf9a",
      storageBucket: "finanzas-9cf9a.firebasestorage.app",
      messagingSenderId: "619666520117",
      appId: "1:619666520117:web:769672477e884d8bed597c",
      measurementId: "G-SJX7L1VH78"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const refUsuarios = db.ref("usuarios");

    const CLAVE_ADMIN = "12345";

    function verificarClave() {
      const clave = document.getElementById("clave").value;
      if (clave === CLAVE_ADMIN) {
        document.getElementById("login").style.display = "none";
        document.getElementById("contenido").style.display = "block";
        cargarDatos();
      } else {
        alert("Clave incorrecta");
      }
    }

    //  Agregar usuario
    document.getElementById("btnAgregarUsuario").addEventListener("click", () => {
      const nombre = document.getElementById("nombre").value.trim();
      if (!nombre) return alert("Escribe un nombre");
      const nuevo = refUsuarios.push();
      nuevo.set({ nombre, deudas: {} });
      document.getElementById("nombre").value = "";
    });

    //  Asignar deuda a todos los usuarios
    document.getElementById("btnAgregarDeuda").addEventListener("click", async () => {
      const monto = document.getElementById("montoDeuda").value.trim();
      if (!monto) return alert("Ingresa un monto");

      const snapshot = await refUsuarios.once("value");
      const usuarios = snapshot.val();
      const nuevaDeudaId = Date.now();

      for (let uid in usuarios) {
        db.ref(`usuarios/${uid}/deudas/${nuevaDeudaId}`).set({
          monto: parseFloat(monto),
          pagado: false
        });
      }

      alert("Deuda asignada a todos los usuarios.");
      document.getElementById("montoDeuda").value = "";
    });

    //  Cambiar estado de pago
    function togglePago(uid, deudaId, actual) {
      db.ref(`usuarios/${uid}/deudas/${deudaId}/pagado`).set(!actual);
    }

    //  Cargar usuarios y deudas
    function cargarDatos() {
      refUsuarios.on("value", (snapshot) => {
        const data = snapshot.val();
        const tabla = document.getElementById("tabla");
        tabla.innerHTML = "<tr><th>Nombre</th><th>Deudas</th></tr>";

        for (let uid in data) {
          let fila = `<tr><td>${data[uid].nombre}</td><td>`;
          if (data[uid].deudas) {
            for (let deudaId in data[uid].deudas) {
              const deuda = data[uid].deudas[deudaId];
              const color = deuda.pagado ? "style='color:blue;'" : "";
              fila += `<span ${color} onclick="togglePago('${uid}','${deudaId}',${deuda.pagado})">
                         ${deuda.monto}
                      </span><br>`;
            }
          } else {
            fila += "Sin deudas";
          }
          fila += "</td></tr>";
          tabla.innerHTML += fila;
        }
      });
    }
  </script>
</body>
</html>
